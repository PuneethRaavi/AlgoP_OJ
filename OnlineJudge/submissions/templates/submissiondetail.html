{% extends 'base.html' %}
{% load static %}
{% load markdown %}

{% block title %}Submission for {{ problem.title }}{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'css/submissiondetail.css' %}">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/material.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/monokai.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/eclipse.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/cobalt.min.css" />
<style>
    .CodeMirror {
        height: 100%;
        border-radius: 0.375rem;
    }  
</style>
{% endblock %}

{% block content %}
<div class="submission-detail-container max-w-full mx-auto -mt-8">
    <div class="h-full w-full grid grid-cols-2 bg-white dark:bg-gray-800/50 rounded-xl shadow-md border border-gray-300 dark:border-gray-600 overflow-hidden">

        <div class="problem-panel flex flex-col border-r border-gray-300 dark:border-gray-600 overflow-hidden">
            <div id="problem-content" class="flex-grow p-6 overflow-y-auto">
                <div class="flex items-center justify-between">
                    <h1 class="text-2xl font-bold text-gray-900 dark:text-white">{{ problem.title }}</h1>
                    {% if problem.difficulty %}
                        <span class="difficulty-badge difficulty-{{ problem.difficulty|title }}">{{ problem.difficulty|title }}</span>
                    {% endif %}
                </div>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                    Time Limit: {{ problem.time_limit }}s | Memory Limit: {{ problem.memory_limit }}MB
                </p>
                <hr class="my-4 border-gray-200 dark:border-gray-700">
                <div class="prose prose-sm dark:prose-invert max-w-none text-gray-700 dark:text-gray-300">
                    {{ problem.description|markdown }}
                </div>

                {% if sample_tests %}
                <div class="mt-6">
                    <h3 class="text-base font-semibold mb-2 text-gray-900 dark:text-white">Sample Testcases</h3>
                    {% for test in sample_tests %}
                    <div class="mt-4">
                        <div class="flex justify-between items-center mb-1">
                            <strong class="text-sm font-medium text-gray-800 dark:text-gray-300">Input:</strong>
                        </div>
                        <pre id="input-{{ forloop.counter }}" class="sample-test-case bg-gray-100 dark:bg-slate-900 rounded-md text-sm text-gray-700 dark:text-gray-300">{{ test.input }}</pre>
                        <strong class="block mt-3 text-sm font-medium text-gray-800 dark:text-gray-300">Expected Output:</strong>
                        <pre class="sample-test-case bg-gray-100 dark:bg-slate-900 rounded-md text-sm text-gray-700 dark:text-gray-300">{{ test.expected_output }}</pre>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            <div class="flex-shrink-0 p-4 border-t border-gray-200 dark:border-gray-700 bg-stone-100/50 dark:bg-slate-950/30">
                <div class="flex justify-between items-center text-xs text-gray-600 dark:text-gray-400">
                    <div>
                        <span>Author: <strong class="font-semibold">{{ problem.author.username }}</strong></span> |
                        <span>Submitted: <strong class="font-semibold">{{ submission.submitted_at|date:"F d, Y, P" }}</strong></span>
                    </div>
                    <div class="flex items-center gap-3">
                        <label for="problem-font-size-selector" class="block text-xs font-medium text-gray-600 dark:text-gray-300">Font</label>
                        <select id="problem-font-size-selector" class="block w-full pl-3 pr-8 py-1 text-xs border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 rounded-md">
                            <option value="8px">8px</option>
                            <option value="10px" selected>10px</option>
                            <option value="12px">12px</option>
                            <option value="14px">14px</option>
                            <option value="16px">16px</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="code-panel flex flex-col overflow-hidden">
            <div class="flex-shrink-0 p-4 border-b border-gray-300 dark:border-gray-600 bg-stone-100/50 dark:bg-slate-950/30 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">Verdict:</span>
                    <span class="rounded-md text-base font-medium
                        {% if submission.status == 'Accepted' %} text-green-800 dark:text-green-300
                        {% elif 'Error' in submission.status or 'Wrong' in submission.status %} text-red-800 dark:text-red-300
                        {% else %} text-yellow-800 dark:text-yellow-300 {% endif %}">
                        {{ submission.status }}
                    </span>
                </div>
                <div class="flex items-center gap-x-6">
                    <div class="flex items-center gap-3">
                        <label for="theme-selector" class="block text-xs font-medium text-gray-600 dark:text-gray-300">Theme</label>
                        <select id="theme-selector" class="block w-full pl-3 pr-8 py-1 text-xs border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 rounded-md">
                            <option value="dracula">Dracula</option>
                            <option value="material">Material</option>
                            <option value="monokai">Monokai</option>
                            <option value="cobalt">Cobalt</option>
                            <option value="eclipse">Eclipse</option>
                        </select>
                    </div>
                    <div class="flex items-center gap-3">
                        <label for="code-font-size-selector" class="block text-xs font-medium text-gray-600 dark:text-gray-300">Font</label>
                        <select id="code-font-size-selector" class="block w-full pl-3 pr-8 py-1 text-xs border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 rounded-md">
                            <option value="8px">8px</option>
                            <option value="10px" selected>10px</option>
                            <option value="12px">12px</option>
                            <option value="14px">14px</option>
                            <option value="16px">16px</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="flex-grow p-4 overflow-y-auto">
                <label for="code-viewer" class="sr-only">Submitted Code</label>
                <textarea id="code-viewer" data-language="{{ submission.language.name }}" class="h-full w-full">{{ code }}</textarea>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/python/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/clike/clike.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>

<script src="{% static 'js/submissiondetail.js' %}"></script>
{% endblock %}