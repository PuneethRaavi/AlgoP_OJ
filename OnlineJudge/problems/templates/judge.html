{% extends 'base.html' %}
{% load static %}
{% load markdown %}

{% block title %}{{ problem.title }} - OnlineJudge{% endblock %}

{% block head_extra %}
<!-- Compiler CSS -->
<link rel="stylesheet" href="{% static 'css/judge.css' %}">
<!-- CodeMirror CSS Files -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/material.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/monokai.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/eclipse.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/cobalt.min.css" />
<!-- Custom styles for CodeMirror height -->
<style>
    .CodeMirror {
        border: 1px solid #d1d5db; /* light mode border */
        border-radius: 0.375rem;
        height: 400px; 
    }
    .dark .CodeMirror {
        border-color: #4b5563; /* dark mode border */
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-full mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

        <!-- Left Panel: Code Runner -->
        <div class="bg-white dark:bg-gray-800/50 dark:backdrop-blur-lg rounded-xl shadow-md border border-gray-200 dark:border-gray-700 p-6 flex flex-col code-panel">
            <form method="post" novalidate class="flex flex-col flex-grow">
                {% csrf_token %}
                
                <!-- Language and Theme Selectors -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-4">
                    <div>
                        <label for="{{ form.language.id_for_label }}" class="block text-sm font-semibold text-gray-700 dark:text-gray-300">Language</label>
                        {{ form.language }}
                    </div>
                    <div>
                        <label for="{{ form.theme.id_for_label }}" class="block text-sm font-semibold text-gray-700 dark:text-gray-300">{{ form.theme.label }}</label>
                        {{ form.theme }}
                    </div>
                </div>
                
                <!-- CodeMirror Editor -->
                <div class="mb-3 flex-grow">
                    {{ form.code }}
                </div>
                
                <hr class="my-4 dark:border-gray-600"> 
                <!-- Custom Input -->
                <div class="mb-6">
                    {{ form.input }}
                </div>
                
                <!-- Action Buttons -->
                <div class="flex gap-4">
                    <button type="submit" name="action" value="run" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-sky-600 hover:bg-sky-700">Run Code</button>
                    <button type="submit" name="action" value="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-rose-600 hover:bg-rose-700">Submit</button>
                </div>
            </form>
        </div>
        
        <!-- Right Panel: Problem Description -->
        <div class="bg-white dark:bg-gray-800/50 dark:backdrop-blur-lg rounded-xl shadow-md border border-gray-200 dark:border-gray-700 p-6 problem-panel">
            <div class="flex items-center justify-between">
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">{{ problem.title }}</h2>
                <span class="difficulty-badge difficulty-{{ problem.difficulty }}">{{ problem.difficulty }}</span>
            </div>
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Time Limit: {{ problem.time_limit }}s | Memory Limit: {{ problem.memory_limit }}MB</p>
            <hr class="my-4 dark:border-gray-600">
            <div class="prose dark:prose-invert max-w-none">
                {{ problem.description|markdown }}
            </div>

            {% if sample_tests %}
            <div class="mt-6">
                <h3 class="text-xl font-semibold mb-2 text-gray-900 dark:text-white">Sample Testcases</h3>
                {% for test in sample_tests %}
                <div class="mt-4">
                    <div class="flex justify-between items-center mb-1">
                        <strong class="text-sm font-medium text-gray-800 dark:text-gray-300">Input:</strong>
                        <button type="button" class="text-xs text-sky-600 hover:text-teal-900 dark:text-sky-400 dark:hover:text-sky-300 font-semibold" onclick="copyToClipboard('input-{{ forloop.counter }}')">Copy</button>
                    </div>
                    <pre id="input-{{ forloop.counter }}" class="bg-gray-100 dark:bg-gray-900 p-3 rounded-md text-sm text-gray-700 dark:text-gray-300">{{ test.input }}</pre>
                    <strong class="block mt-2 text-sm font-medium text-gray-800 dark:text-gray-300">Expected Output:</strong>
                    <pre class="bg-gray-100 dark:bg-gray-900 p-3 rounded-md text-sm text-gray-700 dark:text-gray-300">{{ test.expected_output }}</pre>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Bottom Panel: Results -->
    {% if status or output %}
    <div class="mt-8">
        <div class="bg-white dark:bg-gray-800/50 dark:backdrop-blur-lg rounded-xl shadow-md border border-gray-200 dark:border-gray-700 p-6">
            <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Output</h3>
            <hr class="my-4 dark:border-gray-600">
            {% if status %}
            <div class="p-4 rounded-md 
                {% if status == 'Accepted' %} bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300
                {% elif status == 'Pending' or status == 'Running' %} bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300
                {% else %} bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300 {% endif %}">
                <strong>Status:</strong> {{ status }}
            </div>
            {% endif %}
            {% if output %}
            <pre class="bg-gray-900 text-white p-4 rounded-md mt-4 text-sm"><code>{{ output }}</code></pre>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}

{% block scripts %}
<!-- CodeMirror Core JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
<!-- CodeMirror Addons -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closebrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/matchbrackets.min.js"></script>
<!-- Language Modes for Syntax Highlighting -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/python/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/clike/clike.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
<!-- Compiler JS -->
<script src="{% static 'js/judge.js' %}"></script>
{% endblock %}
